# Описание микросервиса "Предоставление доступа"

Назначение: предоставить доступ пользователям выполнять действия в определенные дни выбранного периода.

### Постановка задачи

В информационной системе существует потребность - предоставить доступ пользователю на редактирование данных в дни, которые согласованы руководителем. Линейный сотрудник должен иметь возможность создать заявку на предоставление доступа, а руководитель - согласовывать/отклонять эти заявки или предоставлять доступ пользователю напрямую путем создания уже согласованной заявки. 

### User Stories

Я, как линейный сотрудник, могу создать заявку на предоставление доступа. Для этого я выбираю период и дни в рамках этого периода, которые мне нужны для редактирования данных.

Я, как руководитель, могу:
* просматривать несогласованные и согласованные заявки сотрудников;
* согласовывать или отклонять заявки (в том числе массово) на предоставление доступа от линейных сотрудников;
* предоставлять доступ линейным сотрудникам напрямую (без заявок от них). Для этого выбирать пользователей из списка, период и дни в рамках этого периода, которые доступны для редактирования данных;
* редактировать согласованные заявки - изменять дни, которые доступны линейному сотруднику для редактирования данных;
* удалять согласованные заявки (в том числе массово);

### Функциональные возможности микросервиса

* Создание заявки в статусе "согласовано" или "несогласованно". Если при создании заявки уже есть заявка с таким же статусом, в таком же периоде и на такого же пользователя, то в уже существующую заявку будут добавлены те дни, которых нет в создаваемой заявке.

* Согласование или отклонение заявки в статусе "несогласованно". В том числе массовое, за период.

* Редактирование заявки - возможность изменить дни, в которое пользователю в заданном периоде предоставлен доступ на редактирование данных. Если пользователю в периоде не предоставлен доступ ни на один день, то заявка будет автоматически удалена.

* Удаление заявок в статусе "согласовано". В том числе массовое, за период.

* Обновление данных - повторная загрузка заявок из базы данных.

* Просмотр заявок, сгруппированных по статусу и периоду.

### Режимы работы микросервиса

Микросервис представлен в виде исполняемого файла `RequestViewer.exe`, который работает в двух режимах:
1. CMD режим. Позволяет путем запуска exe с двумя параметрами - название ключа (-createRequest) для выполнения необходимого действия и логин пользователя, который создает заявку - открыть форму, на которой линейный сотрудник создаст несогласованную заявку на предоставление доступа. Данный режим предназначен для запуска функционала в существующей информационной системе.

    В полном виде это выглядит так:

    ..\путь до каталога\RequestViewer.exe "-createRequest" "%s"
    <br>где параметр %s - логин пользователя

    Для пользователя процесс выглядит следующим образом:
    1. Открытие формы для выбора периода (месяц), в рамках которого на следующем шаге будут указаны желаемые дни для предоставления доступа на редактирование данных
    2. Открытие формы для выбора конкретных дней

    После выполнения этих действий пользователь увидит информационное сообщение - "Заявка на открытие доступа отправлена и будет рассмотрена в течение дня."

2. GUI режим. Функционал для руководителя в виде программного интерфейса для работы с заявками на предоставление доступа вне существующей информационной системы.

### Структуры данных

#### Периоды (Periods)

| Название поля   | Значение                              |
| --------------- | ------------------------------------- |
| `Id`            | Уникальный индентификатор             |
| `StartDate`     | Дата начала периода                   |
| `EndDate`       | Дата окончания периода                |
| `IsEnabled`     | 0 - Период открыт; 1 - Период закрыт  |

#### Пользователи (Users)

| Название поля       | Значение                             |
| ------------------- | ------------------------------------ |
| `Id`                | Уникальный индентификатор            |
| `ActiveDirectoryCN` | Имя пользователя из Active Directory |
| `Email`             | Электронная почта пользователя       |
| `Login`             | Логин пользователя                   |

#### Заявки (Requests)

| Название поля | Значение                                             |
| ------------- | ---------------------------------------------------- |
| `Id`          | Уникальный индентификатор                            |
| `UserName`    | Логин пользователя                                   |
| `PeriodId`    | Id периода                                           |
| `IsApproved`  | 0 - Несогласованная заявка; 1 - Согласованная заявка |

#### Детали заявки (RequestDays)

| Название поля | Значение                                        |
| ------------- | ----------------------------------------------- |
| `Id`          | Уникальный индентификатор                       |
| `RequestId`   | Id заявки                                       |
| `AllowedDate` | День, на который необходимо предоставить доступ |